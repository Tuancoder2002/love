<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gh√©p 1000 m·∫£nh v√¨ c·∫≠u üíò</title>
  <style>
    body {
      text-align: center;
      background: linear-gradient(135deg, #ffe6e6, #fffafc);
      font-family: monospace;
      white-space: pre;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      margin: 0;
      padding: 20px;
      animation: backgroundGradient 10s ease infinite;
    }

    @keyframes backgroundGradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    canvas {
      border: 3px solid #ff99aa;
      margin: 20px auto;
      max-width: 100%;
      height: auto;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(255, 153, 170, 0.3);
      transition: all 0.3s ease;
    }

    canvas:hover {
      transform: scale(1.02);
      box-shadow: 0 8px 20px rgba(255, 153, 170, 0.4);
    }

    pre {
      margin: 20px auto;
      font-size: 8px; 
      line-height: 6px; 
      letter-spacing: 0px; 
      display: inline-block;
      text-align: center;
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      color: black;
      border: 2px solid #ffccd5;
      transition: all 0.3s ease;
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    pre:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    h1 {
      color: #ff6b81;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(255, 107, 129, 0.2);
      font-size: 24px;
      animation: titleFloat 3s ease-in-out infinite;
    }

    @keyframes titleFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    #status {
      color: #ff6b81;
      font-size: 18px;
      margin-top: 20px;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      box-shadow: 0 3px 10px rgba(255, 107, 129, 0.2);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .start-button {
      padding: 15px 30px;
      font-size: 18px;
      background: linear-gradient(45deg, #ff6b81, #ff4757);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(255, 107, 129, 0.3);
      transition: all 0.3s ease;
      margin: 20px 0;
    }

    .start-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 107, 129, 0.4);
    }

    .start-button:active {
      transform: translateY(1px);
    }

    #canvas {
      display: none;
    }

    .music-control {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(255, 107, 129, 0.2);
      transition: all 0.3s ease;
      z-index: 1000;
      font-size: 24px;
    }

    .music-control:hover {
      transform: scale(1.1);
    }

    .music-control.playing {
      animation: rotate 4s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .quiz-section, .result-section {
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(255, 107, 129, 0.2);
      margin: 20px auto;
      max-width: 600px;
      text-align: left;
    }

    .quiz-container {
      margin: 20px 0;
    }

    .question {
      margin-bottom: 25px;
      padding: 20px;
      background: rgba(255, 235, 235, 0.5);
      border-radius: 15px;
      border-left: 4px solid #ff6b81;
    }

    .question p {
      color: #ff4757;
      margin-bottom: 15px;
      font-size: 16px;
    }

    .question label {
      display: block;
      margin: 10px 0;
      padding: 8px 12px;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .question label:hover {
      background: #ffe6e6;
      border-color: #ff99aa;
      transform: translateX(5px);
    }

    .question input[type="radio"] {
      margin-right: 10px;
      accent-color: #ff6b81;
    }

    .submit-button {
      padding: 15px 30px;
      font-size: 18px;
      background: linear-gradient(45deg, #ff6b81, #ff4757);
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(255, 107, 129, 0.3);
      transition: all 0.3s ease;
      margin: 20px auto;
      display: block;
    }

    .submit-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 107, 129, 0.4);
    }

    .submit-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .result-section h2 {
      color: #ff6b81;
      text-align: center;
      margin-bottom: 20px;
    }

    .result-section p {
      font-size: 16px;
      line-height: 1.6;
      color: #333;
      text-align: center;
      margin-bottom: 25px;
    }
  </style>
</head>
<body>
  <audio id="bgMusic">
    <source src="I-Do-911.mp3" type="audio/mpeg">
  </audio>
  <div id="musicControl" class="music-control">üéµ</div>
  <h1>üß© B√†i test ƒë·ªô t·ª± tin </h1>
  <button id="startButton" class="start-button">B·∫Øt ƒë·∫ßu test</button>
  
  <!-- Quiz Section -->
  <div id="quizSection" class="quiz-section" style="display: none;">
    <h2>üìù Test ƒë·ªô t·ª± tin c·ªßa b·∫°n üí™</h2>
    <div class="quiz-container">
      <div class="question">
        <p><strong>1. Khi g·∫∑p th·ª≠ th√°ch m·ªõi, b·∫°n th∆∞·ªùng:</strong></p>
        <label><input type="radio" name="q1" value="a"> A. C·∫£m th·∫•y h·ªìi h·ªôp nh∆∞ng v·∫´n mu·ªën th·ª≠</label>
        <label><input type="radio" name="q1" value="b"> B. T·ª± tin r·∫±ng m√¨nh s·∫Ω l√†m ƒë∆∞·ª£c</label>
        <label><input type="radio" name="q1" value="c"> C. Lo l·∫Øng v√† mu·ªën tr√°nh n√©</label>
      </div>
      
      <div class="question">
        <p><strong>2. B·∫°n ƒë√°nh gi√° kh·∫£ nƒÉng c·ªßa b·∫£n th√¢n nh∆∞ th·∫ø n√†o?</strong></p>
        <label><input type="radio" name="q2" value="a"> A. Kh√° t·ªët, lu√¥n c·ªë g·∫Øng h·ªçc h·ªèi</label>
        <label><input type="radio" name="q2" value="b"> B. R·∫•t t·ª± tin v√†o nƒÉng l·ª±c c·ªßa m√¨nh</label>
        <label><input type="radio" name="q2" value="c"> C. C√≤n nhi·ªÅu thi·∫øu s√≥t c·∫ßn c·∫£i thi·ªán</label>
      </div>
      
      <div class="question">
        <p><strong>3. Khi ng∆∞·ªùi kh√°c khen ng·ª£i b·∫°n:</strong></p>
        <label><input type="radio" name="q3" value="a"> A. C·∫£m th·∫•y vui v√† ƒë·ªông vi√™n</label>
        <label><input type="radio" name="q3" value="b"> B. Th·∫•y ƒë√≥ l√† ƒëi·ªÅu ƒë∆∞∆°ng nhi√™n</label>
        <label><input type="radio" name="q3" value="c"> C. Nghƒ© r·∫±ng h·ªç ch·ªâ n√≥i x√£ giao</label>
      </div>
      
      <div class="question">
        <p><strong>4. Tr∆∞·ªõc khi l√†m vi·ªác g√¨ ƒë√≥ quan tr·ªçng:</strong></p>
        <label><input type="radio" name="q4" value="a"> A. Chu·∫©n b·ªã k·ªπ l∆∞·ª°ng v√† tin t∆∞·ªüng</label>
        <label><input type="radio" name="q4" value="b"> B. T·ª± tin m√¨nh s·∫Ω x·ª≠ l√Ω t·ªët</label>
        <label><input type="radio" name="q4" value="c"> C. Lo l·∫Øng v·ªÅ k·∫øt qu·∫£ kh√¥ng t·ªët</label>
      </div>
      
      <div class="question">
        <p><strong>5. B·∫°n nghƒ© v·ªÅ t∆∞∆°ng lai c·ªßa m√¨nh:</strong></p>
        <label><input type="radio" name="q5" value="a"> A. L·∫°c quan v√† c√≥ k·∫ø ho·∫°ch r√µ r√†ng</label>
        <label><input type="radio" name="q5" value="b"> B. Ch·∫Øc ch·∫Øn s·∫Ω th√†nh c√¥ng</label>
        <label><input type="radio" name="q5" value="c"> C. C√≥ nhi·ªÅu lo l·∫Øng v√† b·∫•t an</label>
      </div>
    </div>
    
    <button id="submitQuiz" class="submit-button">G·ª≠i k·∫øt qu·∫£ üì§</button>
  </div>
  
  <!-- Result Section -->
  <div id="resultSection" class="result-section" style="display: none;">
    <h2 id="resultTitle">üéØ K·∫øt qu·∫£ c·ªßa b·∫°n</h2>
    <p id="resultText"></p>
    <button id="startPuzzle" class="start-button">B·∫Øt ƒë·∫ßu gh√©p h√¨nh üíù</button>
  </div>
  
  <canvas id="canvas" width="380" height="600"></canvas>
  <p id="status">Nh·∫•n n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu test...</p>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    const startButton = document.getElementById('startButton');
    const status = document.getElementById('status');
    const quizSection = document.getElementById('quizSection');
    const resultSection = document.getElementById('resultSection');
    const submitQuiz = document.getElementById('submitQuiz');
    const startPuzzle = document.getElementById('startPuzzle');
    
    let pieces = [];
    let activePieces = [];
    let index = 0;
    let animationDone = false;
    let scaleX, scaleY;  // Th√™m bi·∫øn to√†n c·ª•c

    const COLS = 25;
    const ROWS = 42;
    const BATCH_SIZE = 5;  // Gi·∫£m s·ªë l∆∞·ª£ng m·∫£nh ƒë∆∞·ª£c th√™m v√†o m·ªói l·∫ßn
    const FRAME_DURATION = 60;  // TƒÉng th·ªùi gian cho m·ªói frame

    // Quiz Logic
    function calculateConfidenceLevel() {
      const answers = {
        q1: document.querySelector('input[name="q1"]:checked')?.value,
        q2: document.querySelector('input[name="q2"]:checked')?.value,
        q3: document.querySelector('input[name="q3"]:checked')?.value,
        q4: document.querySelector('input[name="q4"]:checked')?.value,
        q5: document.querySelector('input[name="q5"]:checked')?.value
      };

      let score = 0;
      Object.values(answers).forEach(answer => {
        if (answer === 'b') score += 3; // R·∫•t t·ª± tin
        else if (answer === 'a') score += 2; // T·ª± tin v·ª´a ph·∫£i
        else if (answer === 'c') score += 1; // √çt t·ª± tin
      });

      if (score >= 13) {
        return {
          level: "R·∫•t t·ª± tin! üåü",
          message: "B·∫°n l√† ng∆∞·ªùi r·∫•t t·ª± tin v√† m·∫°nh m·∫Ω! B·∫°n tin t∆∞∆°ng v√†o kh·∫£ nƒÉng c·ªßa m√¨nh v√† kh√¥ng ng·∫°i ƒë·ªëi m·∫∑t v·ªõi th·ª≠ th√°ch. H√£y ti·∫øp t·ª•c gi·ªØ v·ªØng tinh th·∫ßn n√†y nh√©! üí™‚ú®"
        };
      } else if (score >= 9) {
        return {
          level: "T·ª± tin c√¢n b·∫±ng üåà",
          message: "B·∫°n c√≥ m·ª©c ƒë·ªô t·ª± tin kh√° t·ªët! B·∫°n bi·∫øt c√°ch ƒë√°nh gi√° b·∫£n th√¢n m·ªôt c√°ch th·ª±c t·∫ø v√† lu√¥n c·ªë g·∫Øng h·ªçc h·ªèi. ƒê√¢y l√† m·ªôt ph·∫©m ch·∫•t r·∫•t ƒë√°ng qu√Ω! üåüüíñ"
        };
      } else {
        return {
          level: "C·∫ßn th√™m t·ª± tin üå±",
          message: "B·∫°n c·∫ßn tin v√†o b·∫£n th√¢n nhi·ªÅu h∆°n! M·ªói ng∆∞·ªùi ƒë·ªÅu c√≥ nh·ªØng ƒëi·ªÉm m·∫°nh ri√™ng. H√£y nh·ªõ r·∫±ng b·∫°n c≈©ng r·∫•t ƒë·∫∑c bi·ªát v√† c√≥ th·ªÉ l√†m ƒë∆∞·ª£c nhi·ªÅu ƒëi·ªÅu tuy·ªát v·ªùi! üå∏üíù"
        };
      }
    }

    function showQuizResult() {
      const result = calculateConfidenceLevel();
      document.getElementById('resultTitle').textContent = `üéØ ${result.level}`;
      document.getElementById('resultText').textContent = result.message;
      
      quizSection.style.display = 'none';
      resultSection.style.display = 'block';
      status.innerText = 'Xem k·∫øt qu·∫£ v√† nh·∫•n ƒë·ªÉ xem ·∫£nh gh√©p! üéâ';
    }

    // Event Listeners
    startButton.addEventListener('click', () => {
      startButton.style.display = 'none';
      quizSection.style.display = 'block';
      status.innerText = 'H√£y tr·∫£ l·ªùi c√°c c√¢u h·ªèi ƒë·ªÉ test ƒë·ªô t·ª± tin! üìù';
    });

    submitQuiz.addEventListener('click', () => {
      const questions = ['q1', 'q2', 'q3', 'q4', 'q5'];
      const allAnswered = questions.every(q => document.querySelector(`input[name="${q}"]:checked`));
      
      if (allAnswered) {
        // ·∫®n quiz v√† hi·ªÉn th·ªã th√¥ng ƒëi·ªáp ƒë·∫∑c bi·ªát
        quizSection.style.display = 'none';
        status.innerText = 'üíñ Kh√¥ng ƒë√°nh gi√° ƒë∆∞·ª£c, em ph·∫£i l√† ch√≠nh em ÔøΩ';
        
        // Hi·ªÉn th·ªã canvas v√† b·∫Øt ƒë·∫ßu gh√©p h√¨nh sau 2 gi√¢y
        setTimeout(() => {
          canvas.style.display = 'block';
          status.innerText = 'ƒêang gh√©p t·ª´ng m·∫£nh...';
          playMusic();
          animate();
        }, 2000);
      } else {
        alert('Vui l√≤ng tr·∫£ l·ªùi t·∫•t c·∫£ c√°c c√¢u h·ªèi! üòä');
      }
    });

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    function imageToAscii(img, width) {
      const tempCanvas = document.createElement('canvas');
      const aspectRatio = img.naturalWidth / img.naturalHeight;
      const height = Math.floor(width / aspectRatio);
      tempCanvas.width = width;
      tempCanvas.height = height;
      const tempCtx = tempCanvas.getContext('2d');
      tempCtx.drawImage(img, 0, 0, width, height);
      const imageData = tempCtx.getImageData(0, 0, width, height).data;

      // S·ª≠ d·ª•ng m·ªôt k√Ω t·ª± duy nh·∫•t ƒë·ªÉ t·∫°o h√¨nh ·∫£nh r√µ r√†ng h∆°n
      const asciiChars = "N ";  // Ch·ªâ s·ª≠ d·ª•ng "T" v√† kho·∫£ng tr·∫Øng
      const numChars = asciiChars.length;
      const grayScaleLevels = 256 / numChars;
      let asciiArt = "";
      
      for (let j = 0; j < height; j++) {
        for (let i = 0; i < width; i++) {
          const pixelIndex = (j * width + i) * 4;
          const r = imageData[pixelIndex];
          const g = imageData[pixelIndex + 1];
          const b = imageData[pixelIndex + 2];
          const brightness = Math.floor((0.299 * r + 0.587 * g + 0.114 * b));
          const charIndex = Math.floor(brightness / grayScaleLevels);
          asciiArt += asciiChars[charIndex < numChars ? charIndex : numChars - 1];
        }
        asciiArt += '\n';
      }
      return '<pre>' + asciiArt + '</pre>';
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      activePieces.forEach(p => {
        p.progress += 0.5 / FRAME_DURATION;  // Gi·∫£m t·ªëc ƒë·ªô di chuy·ªÉn c·ªßa m·ªói m·∫£nh
        if (p.progress >= 1) {
          p.progress = 1;
          p.done = true;
        }

        const x = p.tx + (p.ex - p.tx) * easeOutCubic(p.progress);
        const y = p.ty + (p.ey - p.ty) * easeOutCubic(p.progress);

        ctx.drawImage(
          img,
          p.sx, p.sy, p.sw, p.sh,
          x, y, p.sw * scaleX, p.sh * scaleY
        );
      });

      if (index < pieces.length) {
        const batch = pieces.slice(index, index + BATCH_SIZE);
        activePieces = activePieces.concat(batch);
        index += BATCH_SIZE;
      }

      activePieces = activePieces.filter(p => !p.done);

      if (index < pieces.length || activePieces.length > 0) {
        requestAnimationFrame(animate);
      } else {
        if (!animationDone) {
          canvas.style.display = 'none';
          const asciiWidth = 150;
          const asciiArt = imageToAscii(img, asciiWidth);
          // Thay v√¨ thay th·∫ø to√†n b·ªô innerHTML, ch·ªâ th√™m ASCII art v√†o cu·ªëi
          const container = document.createElement('div');
          container.innerHTML = asciiArt;
          document.body.appendChild(container);
          
          // C·∫≠p nh·∫≠t status text m√† kh√¥ng l√†m m·∫•t c√°c element kh√°c
          const statusElement = document.getElementById('status');
          if (statusElement) {
            statusElement.innerText = `  üéâ T·∫∑ng em n√®
    Anh v·∫Ω ·∫£nh em b·∫±ng 1000 ch·ªØ N n√® üíñ`;
          }
          
          animationDone = true;
        }
      }
    }

    // Di chuy·ªÉn s·ª± ki·ªán click sau khi img.onload
    img.onload = () => {
      const pieceWidth = img.naturalWidth / COLS;
      const pieceHeight = img.naturalHeight / ROWS;
      scaleX = canvas.width / img.naturalWidth;   // G√°n gi√° tr·ªã cho bi·∫øn to√†n c·ª•c
      scaleY = canvas.height / img.naturalHeight;  // G√°n gi√° tr·ªã cho bi·∫øn to√†n c·ª•c

      // Kh·ªüi t·∫°o pieces
      for (let row = 0; row < ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
          const targetX = col * pieceWidth * scaleX;
          const targetY = row * pieceHeight * scaleY;

          let startX, startY;
          const side = Math.floor(Math.random() * 4);
          const margin = 20;
          if (side === 0) {
            startX = Math.random() * canvas.width;
            startY = -pieceHeight * scaleY - margin;
          } else if (side === 1) {
            startX = Math.random() * canvas.width;
            startY = canvas.height + pieceHeight * scaleY + margin;
          } else if (side === 2) {
            startX = -pieceWidth * scaleX - margin;
            startY = Math.random() * canvas.height;
          } else {
            startX = canvas.width + pieceWidth * scaleX + margin;
            startY = Math.random() * canvas.height;
          }

          pieces.push({
            sx: col * pieceWidth,
            sy: row * pieceHeight,
            sw: pieceWidth,
            sh: pieceHeight,
            tx: startX,
            ty: startY,
            ex: targetX,
            ey: targetY,
            progress: 0,
            done: false
          });
        }
      }

      // Th√™m s·ª± ki·ªán click sau khi pieces ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o
      // Logic n√†y ƒë√£ ƒë∆∞·ª£c chuy·ªÉn l√™n tr√™n trong ph·∫ßn Quiz Logic
    };

    const bgMusic = document.getElementById('bgMusic');
    const musicControl = document.getElementById('musicControl');
    let isMusicPlaying = false;

    // H√†m x·ª≠ l√Ω vi·ªác ph√°t nh·∫°c
    function playMusic() {
      if (bgMusic) {
        const playPromise = bgMusic.play();
        
        if (playPromise !== undefined) {
          playPromise.then(_ => {
            isMusicPlaying = true;
            musicControl.classList.add('playing');
          })
          .catch(error => {
            console.log("Kh√¥ng th·ªÉ t·ª± ƒë·ªông ph√°t nh·∫°c:", error);
          });
        }
      }
    }

    // B·ªè s·ª± ki·ªán t·ª± ƒë·ªông ph√°t nh·∫°c khi click b·∫•t k·ª≥ ƒë√¢u

    // X·ª≠ l√Ω n√∫t ƒëi·ªÅu khi·ªÉn nh·∫°c
    musicControl.addEventListener('click', (e) => {
      e.stopPropagation();
      if (bgMusic) {
        if (isMusicPlaying) {
          bgMusic.pause();
          musicControl.classList.remove('playing');
        } else {
          playMusic();
        }
        isMusicPlaying = !isMusicPlaying;
      }
    });

    img.src = 'na.png';
  </script>
</body>
</html>